# Sistema de Respaldo y Exportaci√≥n de Datos

## Fecha: 15 de Octubre de 2025

## üìã Resumen Ejecutivo

Se implement√≥ un sistema completo de **respaldo y exportaci√≥n de datos** que garantiza:

1. ‚úÖ **Resguardo de informaci√≥n** - Todos los datos est√°n en MongoDB con respaldos bajo demanda
2. ‚úÖ **Descarga por segmentador** - Exportar cargas de trabajo individuales en CSV
3. ‚úÖ **Resumen de equipo** - Exportar estad√≠sticas consolidadas de todos los segmentadores
4. ‚úÖ **Respaldo completo** - Exportar toda la base de datos en JSON para recuperaci√≥n

---

## üîí Respuesta a tu Pregunta: "¬øEst√° resguardada la informaci√≥n?"

### ‚úÖ **S√ç, tu informaci√≥n est√° completamente resguardada**

### C√≥mo funciona el resguardo:

#### 1. **MongoDB como Base de Datos Principal**
- **Servidor:** `192.168.1.93:27017`
- **Base de datos:** `segmentacion_db`
- **Colecci√≥n principal:** `batches`
- **Persistencia:** Todos los cambios se guardan inmediatamente

**C√≥digo de respaldo (app.py l√≠nea 297):**
```python
result = batches_col.update_one({"id": batch_id}, {"$set": update_data})
```

Cada vez que:
- Asignas un batch a un segmentador
- Cambias el estatus (NS ‚Üí In ‚Üí S)
- Actualizas comentarios
- Cambias la revisi√≥n (Aprobado/No Aprobado)
- Modificas cualquier campo

**‚Üí Se guarda INMEDIATAMENTE en MongoDB**

#### 2. **Ventajas de MongoDB para Respaldo**
- ‚úÖ **Persistencia en disco** - Los datos sobreviven si el servidor se reinicia
- ‚úÖ **Transacciones ACID** - Los cambios son at√≥micos (se guardan completamente o no se guardan)
- ‚úÖ **R√©plicas** (si est√° configurado) - MongoDB puede tener copias en m√∫ltiples servidores
- ‚úÖ **√çndices optimizados** - B√∫squedas r√°pidas sin perder datos
- ‚úÖ **Sin dependencia de archivos locales** - No se necesita `batches.json` ni archivos CSV locales

#### 3. **¬øQu√© pasa si...?**

| Escenario | ¬øSe pierden datos? | Explicaci√≥n |
|-----------|-------------------|-------------|
| Se cierra el navegador | ‚ùå NO | Datos en MongoDB, no en navegador |
| Se reinicia Flask | ‚ùå NO | Flask lee de MongoDB al iniciar |
| Se reinicia el servidor | ‚ùå NO | MongoDB persiste en disco |
| Falla MongoDB | ‚ö†Ô∏è DEPENDE | Si hay r√©plicas configuradas, NO. Si no, depende del backup del servidor |
| Se elimina un batch por error | ‚ö†Ô∏è S√ç | No hay "undo" autom√°tico, pero puedes restaurar desde un backup JSON |

#### 4. **¬øQu√© NO est√° respaldado autom√°ticamente?**
- ‚ùå **Historial de cambios** - No se registra qui√©n cambi√≥ qu√© y cu√°ndo (esto se puede agregar despu√©s)
- ‚ùå **Versiones anteriores** - Si cambias un comentario, no puedes ver el comentario anterior
- ‚ùå **Backups autom√°ticos peri√≥dicos** - Debes crear backups manualmente (ver secci√≥n siguiente)

---

## üì• Sistema de Exportaci√≥n y Descarga

### Endpoints Implementados

Se agregaron 3 nuevos endpoints en `app.py` (l√≠neas 1819-2031):

#### 1. **Exportar Carga de Trabajo por Segmentador (CSV)**

**Endpoint:** `GET /api/export/segmentador/<nombre>`

**Funci√≥n:** Exportar todos los batches asignados a un segmentador espec√≠fico en formato CSV

**Ejemplo de uso:**
```
GET /api/export/segmentador/Mauricio
```

**Archivo generado:**
```
Mauricio_20251015.csv
```

**Formato del nombre:** `{Segmentador}_{FechaAsignacion}.csv`
- **Segmentador:** Nombre del segmentador
- **FechaAsignacion:** Fecha en formato YYYYMMDD extra√≠da del primer batch asignado

**Contenido del CSV (SIMPLIFICADO):**
| Batch ID | Responsable | Estatus |
|----------|-------------|---------|
| batch_000001 | Mauricio | |
| batch_000002 | Mauricio | |
| batch_000003 | Mauricio | |

**Notas importantes:**
- ‚úÖ Solo 3 columnas: Batch ID, Responsable, Estatus
- ‚úÖ La columna "Estatus" est√° **vac√≠a** intencionalmente para que el segmentador la llene manualmente
- ‚úÖ Formato simple y f√°cil de imprimir o trabajar offline

**C√≥digo implementado (app.py l√≠neas 1819-1892):**
```python
@app.route("/api/export/segmentador/<segmentador>", methods=["GET"])
def export_segmentador_csv(segmentador):
    """Exportar batches de un segmentador espec√≠fico en formato CSV"""
    batches = list(batches_col.find({"assignee": segmentador}, {"_id": 0}).sort("id", 1))

    # Obtener fecha de asignaci√≥n del primer batch
    first_batch_date = ""
    if batches:
        metadata = batches[0].get("metadata", {})
        assigned_at = metadata.get("assigned_at", "")
        if assigned_at:
            # Formato: "2025-10-15 14:30:00" -> "20251015"
            first_batch_date = assigned_at.split()[0].replace("-", "")

    # Crear CSV SIMPLIFICADO (solo 3 columnas)
    output = io.StringIO()
    fieldnames = ["Batch ID", "Responsable", "Estatus"]
    writer = csv.DictWriter(output, fieldnames=fieldnames)
    writer.writeheader()

    for batch in batches:
        writer.writerow({
            "Batch ID": batch.get("id", ""),
            "Responsable": batch.get("assignee", ""),
            "Estatus": ""  # Vac√≠o intencionalmente
        })

    # Nombre: Segmentador_FechaAsignacion.csv
    filename = f"{segmentador}_{first_batch_date}.csv"

    # Retornar archivo CSV con BOM para Excel
    return send_file(mem, mimetype='text/csv', as_attachment=True, download_name=filename)
```

**Uso desde la interfaz:**
1. Ir a "ASIGNAR BATCHES"
2. En la secci√≥n "Descargas y Respaldos"
3. Seleccionar un segmentador del dropdown
4. Clic en "Descargar Carga de Trabajo"
5. Se descarga autom√°ticamente el archivo CSV

**Casos de uso:**
- üìß **Compartir con el segmentador** - Enviar por email su lista de trabajo simple y clara
- üñ®Ô∏è **Imprimir y trabajar offline** - El segmentador puede imprimir su lista y llenar el estatus manualmente
- ‚úçÔ∏è **Seguimiento manual** - Llenar la columna "Estatus" con marcas como "‚úì", "En proceso", "Pendiente", etc.
- üìã **Lista de verificaci√≥n** - Usar como checklist diario de trabajo
- üîç **Auditor√≠a simple** - Archivo con nombre descriptivo que indica qui√©n y cu√°ndo (`Mauricio_20251015.csv`)

---

#### 2. **Exportar Resumen de Asignaciones del Equipo (CSV)**

**Endpoint:** `GET /api/export/all-assignments`

**Funci√≥n:** Exportar un resumen consolidado con estad√≠sticas de todos los segmentadores

**Ejemplo de uso:**
```
GET /api/export/all-assignments
```

**Archivo generado:**
```
resumen_asignaciones_20251015_143052.csv
```

**Contenido del CSV:**
| Segmentador | Total Batches | No Segmentados (NS) | Incompletas (In) | Completados (S) | % Completado | Lista de Batches |
|-------------|---------------|---------------------|------------------|-----------------|--------------|-----------------|
| Mauricio | 15 | 2 | 8 | 5 | 33.3% | batch_000001, batch_000002, batch_000003, ... |
| Maggie | 12 | 1 | 6 | 5 | 41.7% | batch_000010, batch_000011, batch_000012, ... |
| Ceci | 10 | 0 | 3 | 7 | 70.0% | batch_000020, batch_000021, batch_000022, ... |

**C√≥digo implementado (app.py l√≠neas 1894-1977):**
```python
@app.route("/api/export/all-assignments", methods=["GET"])
def export_all_assignments_csv():
    """Exportar resumen de asignaciones de todo el equipo"""
    # Usar agregaci√≥n de MongoDB para calcular estad√≠sticas
    pipeline = [
        {"$match": {"assignee": {"$ne": None}}},
        {"$group": {
            "_id": "$assignee",
            "total": {"$sum": 1},
            "ns": {"$sum": {"$cond": [{"$eq": ["$status", "NS"]}, 1, 0]}},
            "in_progress": {"$sum": {"$cond": [{"$eq": ["$status", "In"]}, 1, 0]}},
            "completed": {"$sum": {"$cond": [{"$eq": ["$status", "S"]}, 1, 0]}},
            "batches": {"$push": "$id"}
        }}
    ]

    results = list(batches_col.aggregate(pipeline))

    # Crear CSV con resumen
    writer.writerow({
        "Segmentador": segmentador,
        "Total Batches": total,
        "% Completado": f"{percentage}%",
        ...
    })
```

**Uso desde la interfaz:**
1. Ir a "ASIGNAR BATCHES"
2. En la secci√≥n "Descargas y Respaldos"
3. Clic en "Resumen Equipo"
4. Se descarga autom√°ticamente el archivo CSV

**Casos de uso:**
- üìä **Reportes gerenciales** - Ver rendimiento de todo el equipo de un vistazo
- üìà **M√©tricas de productividad** - Comparar % completado entre segmentadores
- üìß **Reuniones de equipo** - Compartir estado general del proyecto
- üéØ **Planificaci√≥n** - Identificar qui√©n tiene m√°s/menos carga de trabajo

---

#### 3. **Crear Respaldo Completo de la Base de Datos (JSON)**

**Endpoint:** `GET /api/backup/database`

**Funci√≥n:** Exportar TODA la base de datos en formato JSON estructurado

**Ejemplo de uso:**
```
GET /api/backup/database
```

**Archivo generado:**
```
backup_segmentacion_db_20251015_143052.json
```

**Estructura del JSON:**
```json
{
  "backup_info": {
    "created_at": "2025-10-15 14:30:52",
    "version": "1.0",
    "source": "Dashboard de Segmentaci√≥n"
  },
  "statistics": {
    "total_batches": 45,
    "total_segmentadores": 8,
    "batches_by_status": {
      "NS": 5,
      "In": 20,
      "S": 20
    }
  },
  "segmentadores": [
    {
      "name": "Mauricio",
      "role": "Segmentador",
      "email": "",
      "created_at": "2025-07-23 10:00:00"
    },
    ...
  ],
  "batches": [
    {
      "id": "batch_000001",
      "assignee": "Mauricio",
      "status": "In",
      "folder": "/datos/batch1",
      "mongo_uploaded": true,
      "comments": "En proceso",
      "metadata": {
        "assigned_at": "2025-10-14 10:30:00",
        "due_date": "2025-10-20",
        "priority": "alta",
        "review_status": "Pendiente",
        "total_masks": 150,
        "completed_masks": 75
      }
    },
    ...
  ]
}
```

**C√≥digo implementado (app.py l√≠neas 1979-2031):**
```python
@app.route("/api/backup/database", methods=["GET"])
def backup_database():
    """Crear respaldo completo de la base de datos en JSON"""
    # Obtener todos los datos
    batches = list(batches_col.find({}, {"_id": 0}))
    segmentadores = list(segmentadores_col.find({}, {"_id": 0}))

    # Crear estructura con metadata
    backup_data = {
        "backup_info": {...},
        "statistics": {...},
        "segmentadores": segmentadores,
        "batches": batches
    }

    # Retornar JSON con formato legible
    return app.make_response(json.dumps(backup_data, indent=2, ensure_ascii=False))
```

**Uso desde la interfaz:**
1. Ir a "ASIGNAR BATCHES"
2. En la secci√≥n "Descargas y Respaldos"
3. Clic en "Respaldo DB"
4. Confirmar la acci√≥n en el di√°logo
5. Se descarga autom√°ticamente el archivo JSON

**Casos de uso:**
- üíæ **Respaldo antes de cambios importantes** - Guardar estado actual antes de hacer modificaciones masivas
- üîÑ **Migraci√≥n de datos** - Mover datos a otro servidor o sistema
- üîô **Recuperaci√≥n ante desastres** - Restaurar sistema completo si algo sale mal
- üì¶ **Archivo hist√≥rico** - Guardar snapshot del estado del proyecto en fechas clave
- üî¨ **An√°lisis de datos** - Procesar datos con scripts de Python u otras herramientas

---

## üñ•Ô∏è Interfaz de Usuario

### Ubicaci√≥n: `templates/batch_management.html` (L√≠neas 283-322)

Se agreg√≥ una tarjeta completa con controles de exportaci√≥n:

```html
<!-- Botones de Exportaci√≥n y Respaldo -->
<div class="card mb-3" style="background: rgba(255, 255, 255, 0.15);">
  <div class="card-body py-3">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h6 class="mb-2" style="color: white;">
          <i class="fas fa-download"></i> Descargas y Respaldos
        </h6>
        <small style="color: rgba(255, 255, 255, 0.8);">
          Exporta cargas de trabajo para compartir con el equipo
        </small>
      </div>
      <div class="col-md-6 text-md-end">
        <div class="btn-group btn-group-sm" role="group">
          <button type="button" class="btn btn-light" onclick="downloadAllAssignments()">
            <i class="fas fa-users"></i> Resumen Equipo
          </button>
          <button type="button" class="btn btn-success" onclick="downloadBackup()">
            <i class="fas fa-database"></i> Respaldo DB
          </button>
        </div>
      </div>
    </div>
    <!-- Selector de segmentador individual -->
    <div class="row mt-2">
      <div class="col-md-12">
        <div class="input-group input-group-sm">
          <span class="input-group-text">
            <i class="fas fa-user"></i>
          </span>
          <select id="exportSegmentadorSelect" class="form-select form-select-sm">
            <option value="">Seleccionar segmentador...</option>
            {% for member in crew %}
            <option value="{{ member }}">{{ member }}</option>
            {% endfor %}
          </select>
          <button type="button" class="btn btn-primary btn-sm" onclick="downloadSegmentadorData()">
            <i class="fas fa-file-csv"></i> Descargar Carga de Trabajo
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
```

### Funciones JavaScript (L√≠neas 1399-1472)

#### 1. `downloadSegmentadorData()`
```javascript
window.downloadSegmentadorData = function() {
  const select = document.getElementById('exportSegmentadorSelect');
  const segmentador = select.value;

  if (!segmentador) {
    showNotification('Por favor selecciona un segmentador', 'warning');
    return;
  }

  showNotification(`Preparando descarga de ${segmentador}...`, 'info');
  window.location.href = `/api/export/segmentador/${encodeURIComponent(segmentador)}`;

  setTimeout(() => {
    select.value = '';
    showNotification(`‚úÖ Descarga iniciada para ${segmentador}`, 'success');
  }, 1000);
};
```

#### 2. `downloadAllAssignments()`
```javascript
window.downloadAllAssignments = function() {
  showNotification('Preparando resumen del equipo...', 'info');
  window.location.href = '/api/export/all-assignments';

  setTimeout(() => {
    showNotification('‚úÖ Descarga de resumen iniciada', 'success');
  }, 1000);
};
```

#### 3. `downloadBackup()`
```javascript
window.downloadBackup = function() {
  // Confirmaci√≥n antes de crear backup
  if (!confirm('¬øDeseas crear un respaldo completo de la base de datos?\n\nEsto descargar√° todos los batches y segmentadores en formato JSON.')) {
    return;
  }

  showNotification('Creando respaldo completo...', 'info');
  window.location.href = '/api/backup/database';

  setTimeout(() => {
    showNotification('‚úÖ Respaldo creado exitosamente', 'success');
  }, 1500);
};
```

#### 4. Shortcut de teclado
```javascript
// Permitir presionar Enter en el select para descargar
$('#exportSegmentadorSelect').on('keypress', function(e) {
  if (e.which === 13) { // Enter key
    e.preventDefault();
    downloadSegmentadorData();
  }
});
```

---

## üìù Flujo de Trabajo Recomendado

### 1. **Asignaci√≥n de Batches**
```
1. Asignar batches a segmentadores usando drag & drop
2. Verificar que las m√©tricas se actualicen en tiempo real
3. Crear respaldo despu√©s de asignaciones importantes:
   - Clic en "Respaldo DB"
   - Guardar archivo JSON en carpeta segura
```

### 2. **Compartir Cargas de Trabajo**
```
Cada semana o al inicio de sprint:
1. Seleccionar segmentador del dropdown
2. Clic en "Descargar Carga de Trabajo"
3. Enviar CSV por email al segmentador
4. El segmentador tiene lista clara de sus tareas
```

### 3. **Reportes Gerenciales**
```
Cada viernes o fin de sprint:
1. Clic en "Resumen Equipo"
2. Abrir CSV en Excel/Google Sheets
3. Revisar % completado de cada segmentador
4. Identificar cuellos de botella
5. Ajustar asignaciones seg√∫n sea necesario
```

### 4. **Respaldos Peri√≥dicos**
```
Recomendaci√≥n: Crear backup cada viernes
1. Clic en "Respaldo DB"
2. Guardar JSON con nombre descriptivo:
   - backup_segmentacion_db_20251015_viernes.json
3. Subir a carpeta compartida o Google Drive
4. Mantener √∫ltimos 4-6 backups (1-1.5 meses)
```

---

## üîß Detalles T√©cnicos de Implementaci√≥n

### Modificaciones en `app.py`

**L√≠nea 20-26:** Importaci√≥n de m√≥dulos
```python
from flask import Flask, render_template, request, jsonify, redirect, send_file
from db import get_db, create_indexes
import json
import os
import csv        # NUEVO
import io         # NUEVO
from datetime import datetime
```

**L√≠neas 1815-2031:** Tres nuevos endpoints
- `/api/export/segmentador/<segmentador>` (GET)
- `/api/export/all-assignments` (GET)
- `/api/backup/database` (GET)

### Modificaciones en `batch_management.html`

**L√≠neas 283-322:** Tarjeta de exportaci√≥n con controles UI

**L√≠neas 1399-1472:** Funciones JavaScript de exportaci√≥n

---

## üöÄ Ventajas del Sistema Implementado

### ‚úÖ Para Administradores
- ‚úÖ **Respaldo r√°pido** - Exportar DB completa en 1 clic
- ‚úÖ **Auditor√≠a** - Saber qu√© tiene cada persona asignado
- ‚úÖ **Recuperaci√≥n ante desastres** - Restaurar desde JSON si algo falla
- ‚úÖ **Migraci√≥n f√°cil** - Mover datos a otro sistema con JSON est√°ndar

### ‚úÖ Para Segmentadores
- ‚úÖ **Lista offline** - Tener su carga de trabajo en CSV/Excel
- ‚úÖ **Claridad** - Ver exactamente qu√© batches tienen asignados
- ‚úÖ **Planificaci√≥n** - Organizar su trabajo sin depender del dashboard

### ‚úÖ Para el Equipo
- ‚úÖ **Transparencia** - Todos pueden ver el resumen del equipo
- ‚úÖ **Colaboraci√≥n** - Compartir informaci√≥n f√°cilmente
- ‚úÖ **M√©tricas** - Datos cuantificables de productividad

---

## üõ°Ô∏è Seguridad y Buenas Pr√°cticas

### ‚úÖ Implementadas
- ‚úÖ **Validaci√≥n de entrada** - Se verifica que el segmentador exista antes de exportar
- ‚úÖ **Manejo de errores** - Try/catch en todos los endpoints con mensajes claros
- ‚úÖ **Logging** - Todas las operaciones se registran en consola del servidor
- ‚úÖ **Encoding UTF-8** - CSV con BOM para compatibilidad con Excel en espa√±ol
- ‚úÖ **Nombres de archivo √∫nicos** - Timestamp en cada archivo para evitar sobrescritura

### ‚ö†Ô∏è Consideraciones Futuras
- ‚ö†Ô∏è **Autenticaci√≥n** - Actualmente no hay restricciones de acceso (cualquiera puede descargar)
- ‚ö†Ô∏è **Rate limiting** - No hay l√≠mite de descargas por minuto
- ‚ö†Ô∏è **Tama√±o de archivos** - Con miles de batches, el JSON puede ser muy grande
- ‚ö†Ô∏è **Historial de backups** - No se guardan autom√°ticamente en el servidor

---

## üìä Formato de Archivos

### CSV (Carga de Trabajo Individual)
**Encoding:** UTF-8 con BOM
**Separador:** Coma (,)
**Compatible con:** Excel, Google Sheets, LibreOffice
**Tama√±o estimado:** ~50 bytes por batch (formato ultra simplificado)
**Nombre del archivo:** `{Segmentador}_{FechaAsignacion}.csv` (ej: `Mauricio_20251015.csv`)

**Columnas (SIMPLIFICADAS):**
```
Batch ID, Responsable, Estatus
```

**Ejemplo de contenido:**
```csv
Batch ID,Responsable,Estatus
batch_000001,Mauricio,
batch_000002,Mauricio,
batch_000003,Mauricio,
```

**Notas:**
- La columna "Estatus" est√° **intencionalmente vac√≠a** para que el segmentador la complete
- Formato minimalista ideal para imprimir o trabajar offline
- El nombre del archivo incluye el segmentador y la fecha de asignaci√≥n para f√°cil identificaci√≥n

### CSV (Resumen de Equipo)
**Encoding:** UTF-8 con BOM
**Separador:** Coma (,)
**Tama√±o estimado:** ~200 bytes por segmentador

**Columnas:**
```
Segmentador, Total Batches, No Segmentados (NS),
Incompletas (In), Completados (S), % Completado, Lista de Batches
```

### JSON (Respaldo Completo)
**Encoding:** UTF-8
**Formato:** Indentado (2 espacios)
**Tama√±o estimado:** ~500 bytes por batch + metadata

**Estructura:**
```json
{
  "backup_info": {...},
  "statistics": {...},
  "segmentadores": [{...}],
  "batches": [{...}]
}
```

---

## üîÑ Restauraci√≥n desde Backup

### Escenario: Necesitas restaurar la base de datos

**Opci√≥n 1: Usar m√≥dulo de Gesti√≥n de Datos**
1. Ir a `/data-management`
2. En secci√≥n "Cargar Batches desde JSON"
3. Seleccionar el archivo `backup_segmentacion_db_YYYYMMDD.json`
4. Clic en "Cargar Archivo"
5. El sistema importar√° todos los batches

**Opci√≥n 2: Script de Python** (para t√©cnicos)
```python
import json
from pymongo import MongoClient

# Cargar backup
with open('backup_segmentacion_db_20251015.json', 'r') as f:
    backup = json.load(f)

# Conectar a MongoDB
client = MongoClient('mongodb://192.168.1.93:27017/')
db = client['segmentacion_db']

# Restaurar segmentadores
db.segmentadores.delete_many({})  # ‚ö†Ô∏è Cuidado: borra todo
db.segmentadores.insert_many(backup['segmentadores'])

# Restaurar batches
db.batches.delete_many({})  # ‚ö†Ô∏è Cuidado: borra todo
db.batches.insert_many(backup['batches'])

print(f"‚úÖ Restaurados {len(backup['batches'])} batches y {len(backup['segmentadores'])} segmentadores")
```

**Opci√≥n 3: Importaci√≥n selectiva**
```python
# Restaurar solo batches de un segmentador espec√≠fico
mauricio_batches = [b for b in backup['batches'] if b['assignee'] == 'Mauricio']
db.batches.insert_many(mauricio_batches)
```

---

## üìÖ Calendario de Respaldos Recomendado

### Diario (Autom√°tico - Futuro)
- ‚è∞ Cada d√≠a a las 23:00
- üìç Backup incremental (solo cambios del d√≠a)
- üìÅ Guardar en `/backups/daily/`
- üîÑ Mantener √∫ltimos 7 d√≠as

### Semanal (Manual - Actual)
- ‚è∞ Cada viernes antes de salir
- üìç Backup completo en JSON
- üìÅ Guardar en carpeta compartida con fecha
- üîÑ Mantener √∫ltimas 4 semanas

### Mensual (Manual)
- ‚è∞ √öltimo viernes de cada mes
- üìç Backup completo + resumen de equipo
- üìÅ Archivar en Google Drive
- üîÑ Mantener √∫ltimos 12 meses

### Cr√≠tico (Manual)
Crear backup ANTES de:
- ‚ùó Eliminar batches masivamente
- ‚ùó Cambiar estructura de datos
- ‚ùó Actualizar software/dependencias
- ‚ùó Migrar a nuevo servidor
- ‚ùó Probar nuevas funcionalidades

---

## ‚ùì Preguntas Frecuentes (FAQ)

### ¬øLos backups consumen espacio en el servidor?
**No.** Los backups se descargan directamente a tu computadora. No se almacenan en el servidor Flask.

### ¬øPuedo automatizar los backups?
**S√≠, futuro.** Se puede agregar un cron job o tarea programada que llame al endpoint y guarde el archivo.

### ¬øQu√© pasa si descargo mientras alguien est√° editando?
**No hay problema.** MongoDB maneja m√∫ltiples lecturas simult√°neas. El backup ser√° consistente al momento de la descarga.

### ¬øPuedo descargar solo batches con estatus "In"?
**No actualmente, pero se puede agregar.** Tendr√≠as que modificar el endpoint para aceptar filtros.

### ¬øLos CSV funcionan en Excel en espa√±ol?
**S√≠.** Se usa encoding UTF-8 con BOM espec√≠ficamente para compatibilidad con Excel en espa√±ol.

### ¬øPuedo importar los CSV de vuelta al sistema?
**S√≠.** Usa el m√≥dulo "Gesti√≥n de Datos" (`/data-management`) para cargar JSON. Para CSV, se necesitar√≠a agregar un convertidor CSV‚ÜíJSON.

### ¬øQu√© pasa si MongoDB se cae?
**El sistema no funcionar√° hasta que MongoDB vuelva.** Por eso es importante tener backups JSON externos.

### ¬øLos backups incluyen las m√°scaras (im√°genes)?
**No.** Los backups JSON solo incluyen metadata (nombres, rutas, estados). Las im√°genes est√°n en GridFS y requieren backup por separado.

---

## üéØ Pr√≥ximos Pasos (Mejoras Futuras)

### Alta prioridad
- [ ] **Backups autom√°ticos diarios** con cron job
- [ ] **Historial de cambios** (audit log) - qui√©n cambi√≥ qu√©
- [ ] **Versionado de batches** - poder ver estado anterior

### Media prioridad
- [ ] **Exportar a Excel (.xlsx)** con formato y gr√°ficas
- [ ] **Filtros en exportaci√≥n** - exportar solo batches con criterios espec√≠ficos
- [ ] **Notificaciones por email** - enviar autom√°ticamente CSV a cada segmentador

### Baja prioridad
- [ ] **Dashboard de backups** - ver lista de backups disponibles
- [ ] **Restauraci√≥n desde UI** - subir JSON y restaurar sin c√≥digo
- [ ] **Comparaci√≥n de backups** - ver diferencias entre dos backups

---

## üìû Contacto y Soporte

**Desarrollador:** Claude Code - Anthropic
**Revisado por:** Francisco Servin (faservin)
**Fecha:** 15 de Octubre de 2025

**Para dudas o mejoras:**
1. Revisar este documento primero
2. Verificar logs del servidor (`/tmp/flask_final.log`)
3. Consultar c√≥digo fuente en `app.py` y `batch_management.html`

---

## ‚úÖ Resumen: ¬øEst√° resguardada mi informaci√≥n?

### S√ç, completamente. Aqu√≠ est√° la garant√≠a:

1. ‚úÖ **MongoDB guarda TODO autom√°ticamente** - Cada cambio se persiste de inmediato
2. ‚úÖ **Puedes descargar backup completo** - JSON con todos los datos en 1 clic
3. ‚úÖ **Puedes exportar por segmentador** - CSV para compartir cargas de trabajo
4. ‚úÖ **Puedes ver resumen del equipo** - Estad√≠sticas consolidadas en CSV
5. ‚úÖ **No dependes de archivos locales** - Todo est√° centralizado en MongoDB
6. ‚úÖ **Restauraci√≥n posible** - Con el JSON puedes reconstruir todo el sistema

### Recomendaci√≥n Final:

**Crea un backup semanal cada viernes y gu√°rdalo en una carpeta compartida o Google Drive.**

As√≠ tendr√°s:
- üìÅ Historial de estados del proyecto
- üîô Capacidad de recuperaci√≥n ante errores
- üìä Datos para an√°lisis posterior
- üõ°Ô∏è Tranquilidad de que nada se perder√°

---

**Fin del documento**
